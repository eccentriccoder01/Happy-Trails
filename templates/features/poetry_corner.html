{% extends 'base.html' %}

{% block title %}Poetry Corner - Happy Trails{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/poetry_corner.css') }}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
{% endblock %}

{% block content %}
<!-- ============================================
     üé® POETRY CORNER - MAIN WRAPPER
     ============================================ -->
<div class="poetry-corner-wrapper">
    
    <!-- === HERO SECTION === -->
    <section class="poetry-hero">
        <div class="container">
            <!-- Floating decorative icons -->
            <div class="poetry-floating-icon icon-1">üìñ</div>
            <div class="poetry-floating-icon icon-2">‚ú®</div>
            <div class="poetry-floating-icon icon-3">üå∏</div>
            <div class="poetry-floating-icon icon-4">üé®</div>
            
            <h1 class="poetry-hero-title">Poetry Corner</h1>
            <p class="poetry-hero-subtitle">
                Where words dance with wanderlust, and every verse is a journey waiting to unfold.
                Welcome to a sanctuary of poetic expressions and travel-inspired verses.
            </p>
            <div class="poetry-hero-quote">
                "Poetry is the rhythm of the soul, and travel is its melody" - Kavlin üíñ
            </div>
        </div>
    </section>

    <!-- ============================================
         üìë TAB NAVIGATION SYSTEM
         ============================================ -->
    <section class="poetry-tabs-section">
        <div class="container">
            <div class="tabs-container">
                <div class="tabs-nav">
                    <button class="tab-btn active" data-tab="tab-poetry">
                        <i class="fas fa-book-open"></i>
                        <span class="tab-btn-label">Travel Poetry</span>
                    </button>
                    <button class="tab-btn" data-tab="tab-quotes">
                        <i class="fas fa-quote-left"></i>
                        <span class="tab-btn-label">Quote of the Day</span>
                    </button>
                    <button class="tab-btn" data-tab="tab-community">
                        <i class="fas fa-pen-fancy"></i>
                        <span class="tab-btn-label">Share Your Journey</span>
                    </button>
                    <button class="tab-btn" data-tab="tab-routes">
                        <i class="fas fa-route"></i>
                        <span class="tab-btn-label">Verses Along the Way</span>
                    </button>
                    <button class="tab-btn" data-tab="tab-blog">
                        <i class="fas fa-blog"></i>
                        <span class="tab-btn-label">Kavlin's Blog</span>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- ============================================
         üìñ TAB 1: TRAVEL POETRY
         ============================================ -->
    <div id="tab-poetry" class="tab-content active">
        <section class="travel-poetry-section">
            <div class="container">
                
                <!-- Section Header -->
                <div class="section-header">
                    <h2 class="section-title">Travel Poetry</h2>
                    <p class="section-description">
                        A curated collection of timeless travel poems from renowned poets around the world,
                        alongside exclusive verses crafted with love by Kavlin.
                    </p>
                </div>

                <!-- Filter Tabs -->
                <div class="poetry-filters">
                    <button class="filter-btn active" data-filter="all">
                        <i class="fas fa-globe me-2"></i>All Poems
                    </button>
                    <button class="filter-btn" data-filter="kavlin">
                        <i class="fas fa-heart me-2"></i>Kavlin's Poetry
                    </button>
                    <button class="filter-btn" data-filter="classic">
                        <i class="fas fa-book me-2"></i>Classic Poets
                    </button>
                    <button class="filter-btn" data-filter="journey">
                        <i class="fas fa-road me-2"></i>Journey
                    </button>
                    <button class="filter-btn" data-filter="wanderlust">
                        <i class="fas fa-compass me-2"></i>Wanderlust
                    </button>
                </div>

                <!-- Poetry Grid -->
                <div class="poetry-grid" id="poetryGrid">
                    {% for poem in travel_poems %}
                    <div class="poem-card {% if poem.is_kavlin %}kavlin-special{% endif %}" 
                         data-theme="{{ poem.theme }}"
                         data-author-type="{% if poem.is_kavlin %}kavlin{% else %}classic{% endif %}">
                        
                        <!-- Poem Image -->
                        <div class="poem-image-wrapper">
                            <img src="{{ poem.image }}" alt="{{ poem.title }}" class="poem-image">
                            <div class="poem-overlay">
                                <span class="poem-theme-badge">{{ poem.theme }}</span>
                                <h3 class="poem-title">{{ poem.title }}</h3>
                                <p class="poem-author {% if poem.is_kavlin %}kavlin-author{% endif %}">
                                    by {{ poem.author }}
                                </p>
                            </div>
                        </div>

                        <!-- Poem Content -->
                        <div class="poem-content">
                            <div class="poem-lines">
                                {% for line in poem.lines %}
                                <p>{{ line }}</p>
                                {% endfor %}
                            </div>

                            <!-- Poem Actions -->
                            <div class="poem-actions">
                                <button class="poem-btn" onclick="sharePoem('{{ poem.title }}', '{{ poem.author }}')">
                                    <i class="fas fa-share-alt"></i> Share
                                </button>
                                <button class="poem-btn" onclick="savePoem(this)">
                                    <i class="far fa-heart"></i> Save
                                </button>
                                <div class="poem-stats">
                                    <span class="poem-stat">
                                        <i class="fas fa-heart"></i> {{ range(100, 500) | random }}
                                    </span>
                                    <span class="poem-stat">
                                        <i class="fas fa-eye"></i> {{ range(500, 2000) | random }}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Load More Button -->
                <div class="load-more-wrapper">
                    <button class="load-more-btn" onclick="loadMorePoems()">
                        <i class="fas fa-plus-circle me-2"></i>
                        Discover More Poetry
                    </button>
                </div>

            </div>
        </section>
    </div>

    <!-- ============================================
         üí¨ TAB 2: QUOTE OF THE DAY
         ============================================ -->
    <div id="tab-quotes" class="tab-content">
        <section class="quote-of-day-section">
            <div class="container">
                
                <!-- Section Header -->
                <div class="section-header">
                    <h2 class="section-title">Quote of the Day</h2>
                    <p class="section-description">
                        Start your day with inspiration. Each dawn brings a new verse to light your path
                        and warm your wandering heart. Today's wisdom for {{ current_date.strftime('%B %d, %Y') }}.
                    </p>
                </div>

                <!-- Main Quote Card -->
                <div class="quote-main-card" 
                     style="background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.6)), url('{{ today_quote.bg_image }}');">
                    
                    <div class="quote-badge">
                        <i class="fas fa-calendar-day me-2"></i>
                        {{ current_date.strftime('%B %d, %Y') }}
                    </div>

                    {% if today_quote.is_kavlin %}
                    <div class="quote-kavlin-badge">
                        <i class="fas fa-heart me-2"></i>
                        By Kavlin
                    </div>
                    {% endif %}

                    <div class="quote-content-wrapper">
                        <div class="quote-icon-left">‚ùù</div>
                        <div class="quote-text-main">
                            {{ today_quote.quote }}
                        </div>
                        <div class="quote-icon-right">‚ùû</div>
                    </div>

                    <div class="quote-author-main">
                        <span class="author-dash">‚Äî</span>
                        <span class="author-name">{{ today_quote.author }}</span>
                    </div>

                    <div class="quote-category-badge">
                        <i class="fas fa-tag me-2"></i>
                        {{ today_quote.category }}
                    </div>

                    <div class="quote-actions-main">
                        <button class="quote-action-btn" onclick="shareQuote('{{ today_quote.quote }}', '{{ today_quote.author }}')">
                            <i class="fas fa-share-alt me-2"></i>
                            Share This Wisdom
                        </button>
                        <button class="quote-action-btn" onclick="saveQuoteOfDay(this)">
                            <i class="far fa-bookmark me-2"></i>
                            Save Quote
                        </button>
                        <button class="quote-action-btn" onclick="downloadQuoteImage()">
                            <i class="fas fa-download me-2"></i>
                            Download Image
                        </button>
                    </div>
                </div>

                <!-- Quote Stats -->
                <div class="quote-stats-bar">
                    <div class="stat-item">
                        <i class="fas fa-heart text-danger"></i>
                        <span class="stat-number">1,247</span>
                        <span class="stat-label">Loves</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-share text-primary"></i>
                        <span class="stat-number">823</span>
                        <span class="stat-label">Shares</span>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-bookmark text-warning"></i>
                        <span class="stat-number">564</span>
                        <span class="stat-label">Saved</span>
                    </div>
                </div>

                <!-- Recent Quotes Carousel -->
                <div class="recent-quotes-section">
                    <h3 class="recent-quotes-title">
                        <i class="fas fa-history me-2"></i>
                        Recent Daily Quotes
                    </h3>
                    
                    <div class="quotes-carousel-wrapper">
                        <button class="carousel-nav prev" onclick="scrollQuotesCarousel('left')">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        
                        <div class="quotes-carousel" id="quotesCarousel">
                            {% for quote in recent_quotes %}
                            <div class="quote-mini-card {% if quote.is_kavlin %}kavlin-quote{% endif %}">
                                <div class="quote-mini-image" 
                                     style="background-image: url('{{ quote.bg_image }}');">
                                    {% if quote.is_kavlin %}
                                    <span class="mini-kavlin-badge">
                                        <i class="fas fa-heart"></i>
                                    </span>
                                    {% endif %}
                                </div>
                                <div class="quote-mini-content">
                                    <p class="quote-mini-text">"{{ quote.quote[:80] }}..."</p>
                                    <p class="quote-mini-author">‚Äî {{ quote.author }}</p>
                                    <span class="quote-mini-category">{{ quote.category }}</span>
                                </div>
                                <button class="quote-mini-btn" onclick="viewFullQuote('{{ loop.index0 }}')">
                                    <i class="fas fa-eye me-1"></i> View Full
                                </button>
                            </div>
                            {% endfor %}
                        </div>
                        
                        <button class="carousel-nav next" onclick="scrollQuotesCarousel('right')">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <!-- Subscribe to Daily Quotes -->
                <div class="quote-subscribe-section">
                    <div class="subscribe-card">
                        <div class="subscribe-icon">
                            <i class="fas fa-envelope-open-text"></i>
                        </div>
                        <h4 class="subscribe-title">Get Daily Inspiration in Your Inbox</h4>
                        <p class="subscribe-description">
                            Receive Kavlin's handpicked quotes and poetry every morning.
                            Start your day with beauty and wisdom.
                        </p>
                        <form class="subscribe-form" onsubmit="subscribeToQuotes(event)">
                            <div class="subscribe-input-group">
                                <i class="fas fa-envelope input-icon"></i>
                                <input type="email" 
                                       class="subscribe-input" 
                                       placeholder="your@email.com" 
                                       required>
                                <button type="submit" class="subscribe-btn">
                                    <i class="fas fa-paper-plane me-2"></i>
                                    Subscribe
                                </button>
                            </div>
                        </form>
                        <p class="subscribe-note">
                            <i class="fas fa-lock me-1"></i>
                            We respect your privacy. Unsubscribe anytime.
                        </p>
                    </div>
                </div>

            </div>
        </section>
    </div>

    <!-- ============================================
         ‚úçÔ∏è TAB 3: SHARE YOUR JOURNEY (User Submissions)
         ============================================ -->
    <div id="tab-community" class="tab-content">
        <section class="user-poems-section">
            <div class="container">
                
                <!-- Section Header -->
                <div class="section-header">
                    <h2 class="section-title">Share Your Journey in Verse</h2>
                    <p class="section-description">
                        Every traveler has a poet's heart. Share your short travel poems with the Happy Trails community
                        and let your words inspire fellow wanderers.
                    </p>
                </div>

                <!-- Guest/Login CTA (show if not logged in) -->
                {% if not user_is_logged_in %}
                <div class="guest-submission-cta">
                    <div class="guest-cta-content">
                        <div class="guest-icon">
                            <i class="fas fa-pen-fancy"></i>
                        </div>
                        <h3 class="guest-title">Join Us to Share Your Poetry!</h3>
                        <p class="guest-message">
                            Login or create an account to submit your travel poems and become part of our creative community.
                        </p>
                        <div class="guest-actions">
                            <a href="{{ url_for('login') }}?next={{ url_for('poetry_corner') }}" class="btn-guest-action primary">
                                <i class="fas fa-sign-in-alt me-2"></i>Login
                            </a>
                            <a href="{{ url_for('signup') }}?next={{ url_for('poetry_corner') }}" class="btn-guest-action secondary">
                                <i class="fas fa-user-plus me-2"></i>Sign Up
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Submission Form (show if logged in) -->
                {% if user_is_logged_in %}
                <div class="poem-submission-wrapper">
                    <div class="submission-card">
                        <div class="submission-header">
                            <h3 class="submission-title">
                                <i class="fas fa-feather-alt me-2"></i>
                                Submit Your Travel Poem
                            </h3>
                            <p class="submission-subtitle">
                                Let your words carry the essence of your journey
                            </p>
                        </div>

                        <form id="poemSubmissionForm" class="submission-form">
                            <!-- Step Indicator -->
                            <div class="form-steps">
                                <div class="step active" data-step="1">
                                    <span class="step-number">1</span>
                                    <span class="step-label">Details</span>
                                </div>
                                <div class="step-connector"></div>
                                <div class="step" data-step="2">
                                    <span class="step-number">2</span>
                                    <span class="step-label">Poem</span>
                                </div>
                                <div class="step-connector"></div>
                                <div class="step" data-step="3">
                                    <span class="step-number">3</span>
                                    <span class="step-label">Review</span>
                                </div>
                            </div>

                            <!-- Step 1: Details -->
                            <div class="form-step active" data-step="1">
                                <div class="form-group">
                                    <label for="poemTitle" class="form-label">
                                        <i class="fas fa-heading text-warning me-2"></i>
                                        Poem Title <span class="required">*</span>
                                    </label>
                                    <input type="text" 
                                           id="poemTitle" 
                                           name="title"
                                           class="form-control-custom" 
                                           placeholder="e.g., Mountain Whispers"
                                           maxlength="100"
                                           required>
                                    <small class="form-hint">Give your poem a beautiful title</small>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="poemTheme" class="form-label">
                                            <i class="fas fa-tag text-warning me-2"></i>
                                            Theme <span class="required">*</span>
                                        </label>
                                        <select id="poemTheme" name="theme" class="form-control-custom" required>
                                            <option value="" disabled selected>Choose a theme</option>
                                            {% for theme in submission_themes %}
                                            <option value="{{ theme }}">{{ theme }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="poemLocation" class="form-label">
                                            <i class="fas fa-map-marker-alt text-warning me-2"></i>
                                            Location
                                        </label>
                                        <input type="text" 
                                               id="poemLocation" 
                                               name="location"
                                               class="form-control-custom" 
                                               placeholder="e.g., Himachal Pradesh"
                                               maxlength="100">
                                    </div>
                                </div>

                                <div class="form-navigation">
                                    <button type="button" class="btn-form-nav next" onclick="nextFormStep()">
                                        Next <i class="fas fa-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Step 2: Poem Content -->
                            <div class="form-step" data-step="2">
                                <div class="form-group">
                                    <label for="poemText" class="form-label">
                                        <i class="fas fa-pen-nib text-warning me-2"></i>
                                        Your Poem <span class="required">*</span>
                                    </label>
                                    <textarea id="poemText" 
                                              name="poem_text"
                                              class="form-control-custom poem-textarea" 
                                              placeholder="Write your travel poem here...&#10;Keep it short and sweet (50-500 characters)&#10;&#10;Let your heart speak through words,&#10;Let memories dance on the page,&#10;Every line a step on your journey..."
                                              rows="8"
                                              maxlength="500"
                                              required></textarea>
                                    <div class="char-counter">
                                        <span id="charCount">0</span> / 500 characters
                                        <span class="char-status" id="charStatus">Minimum 50 characters</span>
                                    </div>
                                </div>

                                <div class="poetry-tips">
                                    <h4 class="tips-title">
                                        <i class="fas fa-lightbulb me-2"></i>
                                        Kavlin's Poetry Tips
                                    </h4>
                                    <ul class="tips-list">
                                        <li>üåü Write from your heart - authenticity shines brightest</li>
                                        <li>üé® Paint pictures with words - engage the senses</li>
                                        <li>üöå Capture a moment, feeling, or revelation from your journey</li>
                                        <li>üí´ Don't worry about perfection - raw emotion is beautiful</li>
                                    </ul>
                                </div>

                                <div class="form-navigation">
                                    <button type="button" class="btn-form-nav prev" onclick="prevFormStep()">
                                        <i class="fas fa-arrow-left me-2"></i> Back
                                    </button>
                                    <button type="button" class="btn-form-nav next" onclick="nextFormStep()">
                                        Next <i class="fas fa-arrow-right ms-2"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Step 3: Review & Submit -->
                            <div class="form-step" data-step="3">
                                <div class="preview-card">
                                    <h4 class="preview-title">Preview Your Poem</h4>
                                    <div class="preview-content" id="poemPreview">
                                        <h5 class="preview-poem-title" id="previewTitle">Your Title</h5>
                                        <p class="preview-poem-author">by {{ current_user.first_name }} {{ current_user.last_name }}</p>
                                        <div class="preview-poem-meta">
                                            <span class="preview-theme" id="previewTheme">Theme</span>
                                            <span class="preview-location" id="previewLocation">Location</span>
                                        </div>
                                        <div class="preview-poem-text" id="previewText">
                                            Your poem will appear here...
                                        </div>
                                    </div>
                                </div>

                                <div class="submission-agreement">
                                    <label class="checkbox-label">
                                        <input type="checkbox" id="agreeTerms" required>
                                        <span class="checkbox-text">
                                            I confirm this is my original work and I agree to share it with the Happy Trails community.
                                            My submission may be featured and shared with attribution.
                                        </span>
                                    </label>
                                </div>

                                <div class="form-navigation">
                                    <button type="button" class="btn-form-nav prev" onclick="prevFormStep()">
                                        <i class="fas fa-arrow-left me-2"></i> Back
                                    </button>
                                    <button type="submit" class="btn-form-submit">
                                        <i class="fas fa-paper-plane me-2"></i>
                                        Submit Poem
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                {% endif %}

                <!-- Community Poems Gallery -->
                <div class="community-gallery-section">
                    <h3 class="gallery-title">
                        <i class="fas fa-users me-2"></i>
                        Community Poems
                    </h3>
                    <p class="gallery-subtitle">
                        Beautiful verses from fellow travelers on the Happy Trails journey
                    </p>

                    <!-- Featured Poems -->
                    {% set featured_poems = community_poems | selectattr('is_featured', 'defined') | selectattr('is_featured') | list %}
                    {% if featured_poems %}
                    <div class="featured-poems-banner">
                        <h4 class="featured-title">
                            <i class="fas fa-star me-2"></i>
                            Featured by Kavlin
                        </h4>
                        <div class="featured-poems-grid">
                            {% for poem in featured_poems %}
                            <div class="community-poem-card featured">
                                <div class="poem-card-header">
                                    <div class="author-info">
                                        <img src="{{ poem.author_avatar }}" alt="{{ poem.author }}" class="author-avatar">
                                        <div class="author-details">
                                            <h5 class="author-name">{{ poem.author }}</h5>
                                            <p class="poem-meta">
                                                <i class="fas fa-map-marker-alt me-1"></i>{{ poem.location }}
                                                <span class="meta-dot">‚Ä¢</span>
                                                <i class="fas fa-calendar me-1"></i>{{ poem.submitted_date }}
                                            </p>
                                        </div>
                                    </div>
                                    <div class="featured-badge">
                                        <i class="fas fa-award"></i>
                                    </div>
                                </div>
                                <div class="poem-card-body">
                                    <h4 class="community-poem-title">{{ poem.title }}</h4>
                                    <span class="theme-badge">{{ poem.theme }}</span>
                                    <p class="community-poem-text">{{ poem.poem_text }}</p>
                                </div>
                                <div class="poem-card-footer">
                                    <button class="poem-action-btn like-btn" data-poem-id="{{ poem.id }}" onclick="likePoem(this)">
                                        <i class="far fa-heart"></i>
                                        <span class="like-count">{{ poem.likes }}</span>
                                    </button>
                                    <span class="poem-views">
                                        <i class="fas fa-eye me-1"></i>{{ poem.views }} views
                                    </span>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}

                    <!-- All Community Poems -->
                    <div class="community-poems-grid">
                        {% for poem in community_poems %}
                        {% if not poem.is_featured %}
                        <div class="community-poem-card">
                            <div class="poem-card-header">
                                <div class="author-info">
                                    <img src="{{ poem.author_avatar }}" alt="{{ poem.author }}" class="author-avatar">
                                    <div class="author-details">
                                        <h5 class="author-name">{{ poem.author }}</h5>
                                        <p class="poem-meta">
                                            <i class="fas fa-map-marker-alt me-1"></i>{{ poem.location }}
                                            <span class="meta-dot">‚Ä¢</span>
                                            <i class="fas fa-calendar me-1"></i>{{ poem.submitted_date }}
                                        </p>
                                    </div>
                                </div>
                            </div>
                            <div class="poem-card-body">
                                <h4 class="community-poem-title">{{ poem.title }}</h4>
                                <span class="theme-badge">{{ poem.theme }}</span>
                                <p class="community-poem-text">{{ poem.poem_text }}</p>
                            </div>
                            <div class="poem-card-footer">
                                <button class="poem-action-btn like-btn" data-poem-id="{{ poem.id }}" onclick="likePoem(this)">
                                    <i class="far fa-heart"></i>
                                    <span class="like-count">{{ poem.likes }}</span>
                                </button>
                                <span class="poem-views">
                                    <i class="fas fa-eye me-1"></i>{{ poem.views }} views
                                </span>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>

                    <!-- Load More -->
                    <div class="load-more-wrapper">
                        <button class="load-more-btn" onclick="loadMoreCommunityPoems()">
                            <i class="fas fa-plus-circle me-2"></i>
                            Load More Community Poems
                        </button>
                    </div>
                </div>

            </div>
        </section>
    </div>

    <!-- ============================================
         üó∫Ô∏è TAB 4: VERSES ALONG THE WAY (Phase 4)
         ============================================ -->
    <div id="tab-routes" class="tab-content">
        <section class="route-poetry-section">
            <div class="container">
                
                <!-- Section Header -->
                <div class="section-header">
                    <h2 class="section-title">Verses Along the Way</h2>
                    <p class="section-description">
                        Every route on Happy Trails has its own poetic soul. Discover verses inspired by
                        the journeys we take, the paths we traverse, and the memories we create.
                    </p>
                </div>

                <!-- Route Filters -->
                <div class="route-filters">
                    <button class="route-filter-btn active" data-filter="all">
                        <i class="fas fa-map-signs me-2"></i>All Routes
                    </button>
                    <button class="route-filter-btn" data-filter="kavlin">
                        <i class="fas fa-star me-2"></i>Kavlin's Favorites
                    </button>
                    <button class="route-filter-btn" data-filter="Dharampur">
                        <i class="fas fa-map-marker-alt me-2"></i>Dharampur
                    </button>
                    <button class="route-filter-btn" data-filter="Solan">
                        <i class="fas fa-map-marker-alt me-2"></i>Solan
                    </button>
                    <button class="route-filter-btn" data-filter="Barog">
                        <i class="fas fa-map-marker-alt me-2"></i>Barog
                    </button>
                    <button class="route-filter-btn" data-filter="Dagshai">
                        <i class="fas fa-map-marker-alt me-2"></i>Dagshai
                    </button>
                </div>

                <!-- Kavlin's Favorites Banner -->
                <div class="kavlin-favorites-banner">
                    <h3 class="favorites-title">
                        <i class="fas fa-heart me-2"></i>
                        Kavlin's Favorite Routes
                    </h3>
                    <p class="favorites-subtitle">
                        "These routes hold a special place in my heart, each curve a verse, each stop a stanza..."
                    </p>
                </div>

                <!-- Route Poems Grid -->
                <div class="route-poems-grid">
                    {% for route_poem in route_poems %}
                    <div class="route-poem-card {% if route_poem.is_kavlin_favorite %}kavlin-favorite{% endif %}"
                         data-route-type="{{ route_poem.route_type }}"
                         data-origin="{{ route_poem.from_location }}"
                         data-destination="{{ route_poem.to_location }}">
                        
                        <!-- Route Image -->
                        <div class="route-image-wrapper">
                            <img src="{{ route_poem.image }}" alt="{{ route_poem.route_name }}" class="route-image">
                            <div class="route-overlay">
                                <div class="route-badge">
                                    <i class="fas fa-bus me-1"></i>
                                    Route {{ route_poem.route_number }}
                                </div>
                                <h3 class="route-name">{{ route_poem.route_name }}</h3>
                                <div class="route-details">
                                    <span><i class="fas fa-map-marker-alt me-1"></i>{{ route_poem.from_location }}</span>
                                    <span><i class="fas fa-arrow-right mx-2"></i></span>
                                    <span><i class="fas fa-map-marker-alt me-1"></i>{{ route_poem.to_location }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Route Poem Content -->
                        <div class="route-poem-content">
                            <h4 class="route-poem-title">{{ route_poem.poem_title }}</h4>
                            <div class="route-poem-excerpt">
                                {{ route_poem.poem_excerpt }}
                            </div>

                            <!-- Route Meta -->
                            <div class="route-poem-meta">
                                <div class="season-tag">
                                    <i class="{{ route_poem.season_icon }} me-1"></i>
                                    {{ route_poem.best_season }}
                                </div>
                                <div class="route-actions">
                                    <button class="route-action-btn" 
                                            onclick="shareRoutePoem('{{ route_poem.route_name }}', '{{ route_poem.poem_title }}')">
                                        <i class="fas fa-share-alt"></i>
                                    </button>
                                    <button class="route-action-btn primary" 
                                            onclick="bookRoute('{{ route_poem.from_location }}', '{{ route_poem.to_location }}')">
                                        <i class="fas fa-ticket-alt me-1"></i>
                                        Book Journey
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Interactive Route Map -->
                <div class="route-map-section">
                    <div class="section-header">
                        <h3 class="section-title">Poetic Journey Map</h3>
                        <p class="section-description">
                            Explore the geography of poetry. Each marker represents a route with its own verse.
                        </p>
                    </div>

                    <div class="map-container">
                        <div id="routeMap"></div>
                    </div>

                    <!-- Map Legend -->
                    <div class="map-legend">
                        <div class="legend-item">
                            <span class="legend-icon">üìç</span>
                            <span>Poetry Stops</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">‚≠ê</span>
                            <span>Kavlin's Favorites</span>
                        </div>
                        <div class="legend-item">
                            <span class="legend-icon">üöå</span>
                            <span>Active Routes</span>
                        </div>
                    </div>
                </div>

                <!-- Load More -->
                <div class="load-more-wrapper">
                    <button class="load-more-btn" onclick="loadMoreRoutePoems()">
                        <i class="fas fa-plus-circle me-2"></i>
                        Discover More Route Poetry
                    </button>
                </div>

            </div>
        </section>
    </div>

    <!-- ============================================
         üìù TAB 5: KAVLIN'S POETRY BLOG (Phase 5)
         ============================================ -->
    <div id="tab-blog" class="tab-content">
        <section class="poetry-blog-section">
            <div class="container">
                
                <!-- Section Header -->
                <div class="section-header">
                    <h2 class="section-title">Kavlin's Poetry Blog</h2>
                    <p class="section-description">
                        Journey through my thoughts, stories, and inspirations. From travel tales to writing process,
                        explore the heart behind Happy Trails' poetry.
                    </p>
                </div>

                <!-- Blog Search -->
                <div class="blog-search-bar">
                    <form class="blog-search-form" id="blogSearchForm">
                        <input type="text" 
                               class="blog-search-input" 
                               placeholder="Search blog posts..."
                               name="search">
                        <button type="submit" class="blog-search-btn">
                            <i class="fas fa-search me-2"></i>Search
                        </button>
                    </form>
                </div>

                <!-- Blog Categories -->
                <div class="blog-categories">
                    <button class="blog-category-btn active" data-category="all">
                        <i class="fas fa-th-large"></i>All Posts
                    </button>
                    <button class="blog-category-btn" data-category="travel-tales">
                        <i class="fas fa-mountain"></i>Travel Tales
                    </button>
                    <button class="blog-category-btn" data-category="poetry-process">
                        <i class="fas fa-pen-nib"></i>Poetry Process
                    </button>
                    <button class="blog-category-btn" data-category="route-inspiration">
                        <i class="fas fa-lightbulb"></i>Route Inspirations
                    </button>
                    <button class="blog-category-btn" data-category="guest-posts">
                        <i class="fas fa-users"></i>Guest Posts
                    </button>
                </div>

                <!-- Featured Post -->
                <div class="featured-post-section">
                    <div class="featured-post-card">
                        <img src="{{ blog_posts[0].image }}" alt="{{ blog_posts[0].title }}" class="featured-post-image">
                        <div class="featured-post-content">
                            <span class="featured-badge">
                                <i class="fas fa-star me-2"></i>Featured Post
                            </span>
                            <h3 class="featured-post-title">{{ blog_posts[0].title }}</h3>
                            <div class="featured-post-meta">
                                <div class="meta-item">
                                    <i class="fas fa-user-circle"></i>
                                    <span>{{ blog_posts[0].author }}</span>
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-calendar"></i>
                                    <span>{{ blog_posts[0].date }}</span>
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-clock"></i>
                                    <span>{{ blog_posts[0].read_time }} min read</span>
                                </div>
                            </div>
                            <p class="featured-post-excerpt">{{ blog_posts[0].excerpt }}</p>
                            <div class="featured-post-tags">
                                {% for tag in blog_posts[0].tags %}
                                <span class="tag-badge">{{ tag }}</span>
                                {% endfor %}
                            </div>
                            <button class="featured-post-btn" onclick="readBlogPost('{{ blog_posts[0].id }}')">
                                Read Full Post
                                <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Blog Posts Grid -->
                <div class="blog-posts-grid">
                    {% for post in blog_posts[1:] %}
                    <div class="blog-post-card" data-category="{{ post.category }}">
                        <div class="blog-post-image-wrapper">
                            <img src="{{ post.image }}" alt="{{ post.title }}" class="blog-post-image">
                            <span class="blog-post-category">{{ post.category_label }}</span>
                        </div>
                        <div class="blog-post-content">
                            <h4 class="blog-post-title">{{ post.title }}</h4>
                            <div class="blog-post-meta">
                                <div class="blog-post-author">
                                    <img src="{{ post.author_avatar }}" alt="{{ post.author }}" class="author-avatar-small">
                                    <span>{{ post.author }}</span>
                                </div>
                                <div class="meta-item">
                                    <i class="fas fa-clock"></i>
                                    <span>{{ post.read_time }} min</span>
                                </div>
                            </div>
                            <p class="blog-post-excerpt">{{ post.excerpt }}</p>
                            <div class="blog-post-footer">
                                <div class="blog-post-stats">
                                    <span class="stat">
                                        <i class="fas fa-heart"></i> {{ post.likes }}
                                    </span>
                                    <span class="stat">
                                        <i class="fas fa-comment"></i> {{ post.comments }}
                                    </span>
                                </div>
                                <button class="read-more-btn" onclick="readBlogPost('{{ post.id }}')">
                                    Read More <i class="fas fa-arrow-right ms-1"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Author Spotlight -->
                <div class="author-spotlight-section">
                    <div class="author-spotlight-content">
                        <img src="../../static/images/Kavlin Bitmoji.png" alt="Kavlin" class="author-avatar-large">
                        <div class="author-bio">
                            <h3>About Kavlin</h3>
                            <p class="author-title">Founder, Poet & Chief Dreamer at Happy Trails</p>
                            <p class="author-description">
                                I believe every journey deserves a verse, every mile holds a story. Through Happy Trails,
                                I've combined my love for travel and poetry to create experiences that touch the soul.
                                Join me as I share the stories behind the routes, the inspiration behind the verses,
                                and the magic that happens when we slow down to appreciate the journey.
                            </p>
                            <div class="author-stats">
                                <div class="author-stat-item">
                                    <span class="author-stat-number">{{ blog_posts|length }}+</span>
                                    <span class="author-stat-label">Blog Posts</span>
                                </div>
                                <div class="author-stat-item">
                                    <span class="author-stat-number">50+</span>
                                    <span class="author-stat-label">Poems Written</span>
                                </div>
                                <div class="author-stat-item">
                                    <span class="author-stat-number">10K+</span>
                                    <span class="author-stat-label">Readers</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blog Newsletter -->
                <div class="blog-newsletter-section">
                    <h4 class="blog-newsletter-title">
                        <i class="fas fa-envelope-open-text me-2"></i>
                        Never Miss a Post
                    </h4>
                    <p class="blog-newsletter-description">
                        Get Kavlin's latest blog posts, poetry, and travel stories delivered to your inbox every week.
                    </p>
                    <form class="blog-newsletter-form" onsubmit="subscribeToBlog(event)">
                        <input type="email" 
                               class="blog-newsletter-input" 
                               placeholder="your@email.com" 
                               required>
                        <button type="submit" class="blog-newsletter-btn">
                            <i class="fas fa-paper-plane me-2"></i>Subscribe
                        </button>
                    </form>
                </div>

                <!-- Blog Archive -->
                <div class="blog-archive-section">
                    <div class="section-header">
                        <h3 class="section-title">Blog Archive</h3>
                        <p class="section-description">Explore posts by month</p>
                    </div>
                    <div class="archive-grid">
                        <div class="archive-month-card" onclick="viewArchiveMonth('October', 2025)">
                            <div class="archive-month">October 2025</div>
                            <div class="archive-count">5 posts</div>
                        </div>
                        <div class="archive-month-card" onclick="viewArchiveMonth('September', 2025)">
                            <div class="archive-month">September 2025</div>
                            <div class="archive-count">8 posts</div>
                        </div>
                        <div class="archive-month-card" onclick="viewArchiveMonth('August', 2025)">
                            <div class="archive-month">August 2025</div>
                            <div class="archive-count">6 posts</div>
                        </div>
                        <div class="archive-month-card" onclick="viewArchiveMonth('July', 2025)">
                            <div class="archive-month">July 2025</div>
                            <div class="archive-count">7 posts</div>
                        </div>
                    </div>
                </div>

                <!-- Load More -->
                <div class="load-more-wrapper">
                    <button class="load-more-btn" onclick="loadMoreBlogPosts()">
                        <i class="fas fa-plus-circle me-2"></i>
                        Load More Blog Posts
                    </button>
                </div>

            </div>
        </section>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/poetry_corner.js') }}"></script>
{% endblock %}